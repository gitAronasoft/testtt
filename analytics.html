<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - YouTube Video Manager</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .chart-container {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .chart-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            margin-bottom: 16px;
        }

        .metric-card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .metric-change {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
        }

        .metric-change.positive {
            background: #dcfce7;
            color: #166534;
        }

        .metric-change.negative {
            background: #fee2e2;
            color: #991b1b;
        }

        .time-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .time-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--surface-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .time-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .performance-table {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .table-header {
            background: var(--border-light);
            padding: 16px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="header"></div>

    <div class="container">
        <div class="page-header">
            <h2>üìä Analytics Dashboard</h2>
            <div class="dashboard-actions">
                <button class="btn btn-secondary" onclick="refreshAnalytics()">
                    <span>üîÑ</span> Refresh Data
                </button>
                <a href="dashboard.html" class="btn btn-primary">
                    <span>üè†</span> Back to Dashboard
                </a>
                <button class="btn btn-secondary admin-only" onclick="exportData()">
                    <span>üìä</span> Export Data
                </button>
            </div>
        </div>

        <!-- Time Period Selector -->
        <div class="time-selector">
            <button class="time-btn" onclick="selectTimePeriod('7d', this)">7 Days</button>
            <button class="time-btn active" onclick="selectTimePeriod('30d', this)">30 Days</button>
            <button class="time-btn" onclick="selectTimePeriod('90d', this)">90 Days</button>
            <button class="time-btn" onclick="selectTimePeriod('1y', this)">1 Year</button>
        </div>

        <!-- Key Metrics -->
        <div class="analytics-grid">
            <div class="metric-card">
                <div class="metric-value" id="totalViews">0</div>
                <div class="metric-label">Total Views</div>
                <div class="metric-change positive" id="viewsChange">+12.5%</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="totalSubscribers">0</div>
                <div class="metric-label">Subscribers</div>
                <div class="metric-change positive" id="subscribersChange">+8.3%</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="avgWatchTime">0</div>
                <div class="metric-label">Avg Watch Time</div>
                <div class="metric-change negative" id="watchTimeChange">-2.1%</div>
            </div>
            <div class="metric-card admin-only">
                <div class="metric-value" id="totalRevenue">$0</div>
                <div class="metric-label">Revenue</div>
                <div class="metric-change positive" id="revenueChange">+15.7%</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="analytics-grid">
            <div class="chart-container">
                <div class="chart-placeholder">
                    üìà Views Over Time
                </div>
                <p style="color: var(--text-secondary); font-size: 14px;">Interactive chart showing daily views</p>
            </div>
            <div class="chart-container">
                <div class="chart-placeholder">
                    üéØ Top Performing Videos
                </div>
                <p style="color: var(--text-secondary); font-size: 14px;">Your most viewed content</p>
            </div>
            <div class="chart-container">
                <div class="chart-placeholder">
                    üåç Audience Geography
                </div>
                <p style="color: var(--text-secondary); font-size: 14px;">Where your viewers are located</p>
            </div>
            <div class="chart-container">
                <div class="chart-placeholder">
                    üì± Traffic Sources
                </div>
                <p style="color: var(--text-secondary); font-size: 14px;">How viewers find your videos</p>
            </div>
        </div>

        <!-- Performance Table -->
        <div class="performance-table">
            <div class="table-header">
                <h3>Video Performance</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Video Title</th>
                        <th>Views</th>
                        <th>Watch Time</th>
                        <th>Engagement</th>
                        <th>Revenue</th>
                    </tr>
                </thead>
                <tbody id="performanceTableBody">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="assets/js/common.js"></script>
    <script src="assets/js/header.js"></script>
    <script src="assets/js/visual-enhancements.js"></script>
    <script>
        let currentTimePeriod = '30d';

        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            const userRole = localStorage.getItem('userRole') || 'viewer';

            // Redirect viewers to dashboard
            if (userRole === 'viewer') {
                showNotification('Analytics access requires admin or editor role', 'warning');
                setTimeout(() => window.location.href = 'dashboard.html', 2000);
                return;
            }

            loadAnalytics();
            updateRoleBasedUI();
        });

        function updateRoleBasedUI() {
            const userRole = localStorage.getItem('userRole') || 'viewer';
            const adminElements = document.querySelectorAll('.admin-only');

            adminElements.forEach(el => {
                el.style.display = userRole === 'admin' ? 'block' : 'none';
            });
        }

        function loadAnalytics() {
            // Simulate loading analytics data based on role
            const userRole = localStorage.getItem('userRole') || 'editor';

            const analyticsData = {
                admin: {
                    totalViews: '2.4M',
                    totalSubscribers: '45.2K',
                    avgWatchTime: '4:32',
                    totalRevenue: '$12,450'
                },
                editor: {
                    totalViews: '156K',
                    totalSubscribers: '8.9K',
                    avgWatchTime: '3:45',
                    totalRevenue: '$1,890'
                }
            };

            const data = analyticsData[userRole] || analyticsData.editor;

            // Update metrics
            document.getElementById('totalViews').textContent = data.totalViews;
            document.getElementById('totalSubscribers').textContent = data.totalSubscribers;
            document.getElementById('avgWatchTime').textContent = data.avgWatchTime;

            const revenueElement = document.getElementById('totalRevenue');
            if (revenueElement) {
                revenueElement.textContent = data.totalRevenue;
            }

            loadPerformanceTable();
        }

        function loadPerformanceTable() {
            const tableBody = document.getElementById('performanceTableBody');
            const userRole = localStorage.getItem('userRole') || 'editor';

            const performanceData = [
                { title: 'Getting Started with YouTube', views: '45.2K', watchTime: '4:32', engagement: '8.5%', revenue: '$450' },
                { title: 'Advanced Video Editing', views: '32.1K', watchTime: '6:18', engagement: '12.3%', revenue: '$320' },
                { title: 'Content Strategy Tips', views: '28.7K', watchTime: '5:45', engagement: '9.8%', revenue: '$290' },
                { title: 'Monetization Guide', views: '19.3K', watchTime: '7:22', engagement: '15.6%', revenue: '$195' },
                { title: 'Analytics Deep Dive', views: '15.8K', watchTime: '8:10', engagement: '11.2%', revenue: '$160' }
            ];

            tableBody.innerHTML = performanceData.map(video => `
                <tr>
                    <td>${video.title}</td>
                    <td>${video.views}</td>
                    <td>${video.watchTime}</td>
                    <td>${video.engagement}</td>
                    <td class="${userRole === 'admin' ? '' : 'hidden'}">${video.revenue}</td>
                </tr>
            `).join('');

            // Hide revenue column for non-admin users
            if (userRole !== 'admin') {
                const revenueHeaders = document.querySelectorAll('th:last-child');
                revenueHeaders.forEach(header => {
                    if (header.textContent.includes('Revenue')) {
                        header.style.display = 'none';
                    }
                });
            }
        }

        function selectTimePeriod(period, button) {
            // Remove active class from all buttons
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));

            // Add active class to clicked button
            button.classList.add('active');

            currentTimePeriod = period;

            showNotification(`Analytics updated for ${period}`, 'info');
            loadAnalytics();
        }

        function refreshAnalytics() {
            showNotification('Refreshing analytics data...', 'info');
            setTimeout(() => {
                loadAnalytics();
                showNotification('Analytics refreshed successfully', 'success');
            }, 1500);
        }

        function exportData() {
            showNotification('Generating analytics report...', 'info');
            setTimeout(() => {
                showNotification('Report exported successfully', 'success');
            }, 2000);
        }
    </script>
</body>
</html>