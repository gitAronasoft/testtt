<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>User Management - VideoHub Admin</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.bootstrap5.min.css"
        />
        <link href="../assets/css/modal.css" rel="stylesheet" />
        <style>
            body {
                background-color: #f8f9fa;
            }
            .sidebar {
                min-height: 100vh;
                background-color: white;
                border-right: 1px solid #dee2e6;
            }
            .nav-link {
                color: #495057;
                border-radius: 5px;
                margin: 2px 0;
            }
            .nav-link:hover {
                background-color: #e9ecef;
                color: #495057;
            }
            .nav-link.active {
                background-color: #0d6efd;
                color: white;
            }
            .card {
                border: 1px solid #dee2e6;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }
            .navbar {
                background-color: white;
                border-bottom: 1px solid #dee2e6;
            }

            /* DataTable custom styling */
            .dataTables_wrapper .dataTables_length,
            .dataTables_wrapper .dataTables_filter {
                margin-bottom: 1rem;
            }

            .dataTables_wrapper .dataTables_filter input {
                border-radius: 5px;
                border: 1px solid #ced4da;
                padding: 0.375rem 0.75rem;
            }

            .dataTables_wrapper .dataTables_length select {
                border-radius: 5px;
                border: 1px solid #ced4da;
                padding: 0.375rem 0.75rem;
            }

            .dataTables_wrapper .dataTables_info {
                color: #6c757d;
                font-size: 0.875rem;
            }

            .dataTables_wrapper .dataTables_paginate {
                margin-top: 1rem;
            }

            .dataTables_wrapper .dataTables_paginate .paginate_button {
                padding: 0.5rem 0.75rem !important;
                margin: 0 2px !important;
                border-radius: 5px !important;
                border: 1px solid #dee2e6 !important;
                background: white !important;
                color: #495057 !important;
            }

            .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
                background: #e9ecef !important;
                border-color: #adb5bd !important;
            }

            .dataTables_wrapper .dataTables_paginate .paginate_button.current {
                background: #0d6efd !important;
                border-color: #0d6efd !important;
                color: white !important;
            }

            #usersTable th {
                background-color: #f8f9fa;
                border-bottom: 2px solid #dee2e6;
                color: #495057;
                font-weight: 600;
                font-size: 0.875rem;
                padding: 0.75rem;
                vertical-align: middle;
            }

            #usersTable td {
                vertical-align: middle;
                padding: 0.75rem;
                border-color: #dee2e6;
            }

            .table-striped > tbody > tr:nth-of-type(odd) > td {
                background-color: rgba(0, 0, 0, 0.03);
            }

            .table-hover tbody tr:hover {
                background-color: rgba(13, 110, 253, 0.08);
            }

            .user-avatar {
                width: 40px;
                height: 40px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
                font-size: 0.875rem;
            }

            .btn-group .btn {
                margin: 0 1px;
            }

            .badge {
                font-size: 0.75rem;
                padding: 0.35em 0.65em;
            }
        </style>
    </head>
    <body>
        <!-- Top Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">
                    <i class="fas fa-shield-alt me-2"></i>VideoHub Admin
                </span>
                <div class="navbar-nav ms-auto">
                    <div class="nav-item dropdown">
                        <a
                            class="nav-link dropdown-toggle"
                            href="#"
                            role="button"
                            data-bs-toggle="dropdown"
                        >
                            <i class="fas fa-user me-1"></i>Admin
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="profile.html"
                                    ><i class="fas fa-user me-2"></i>Profile</a
                                >
                            </li>
                            <li><hr class="dropdown-divider" /></li>
                            <li>
                                <a class="dropdown-item logout-btn" href="#"
                                    ><i class="fas fa-sign-out-alt me-2"></i
                                    >Logout</a
                                >
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <nav class="col-md-3 col-lg-2 sidebar">
                    <div class="position-sticky pt-3">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="dashboard.html">
                                    <i class="fas fa-tachometer-alt me-2"></i
                                    >Dashboard
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" href="users.html">
                                    <i class="fas fa-users me-2"></i>Users
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="videos.html">
                                    <i class="fas fa-video me-2"></i>Videos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="transactions.html">
                                    <i class="fas fa-receipt me-2"></i>Transactions
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="profile.html">
                                    <i class="fas fa-cog me-2"></i>Settings
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>

                <!-- Main Content -->
                <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-3">
                    <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom"
                    >
                        <h1 class="h2">User Management</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button
                                    type="button"
                                    class="btn btn-outline-primary"
                                    data-bs-toggle="modal"
                                    data-bs-target="#addUserModal"
                                >
                                    <i class="fas fa-plus me-1"></i>Add User
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-outline-success"
                                    onclick="exportUsers()"
                                >
                                    <i class="fas fa-download me-1"></i>Export
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Users Table -->
                    <div class="card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table
                                    id="usersTable"
                                    class="table table-striped table-hover dt-responsive nowrap"
                                    width="100%"
                                >
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>User</th>
                                            <th>Email</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                            <th>Verified</th>
                                            <th>Joined</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- User rows will be populated dynamically -->
                                    </tbody>
                                </table>
                            </div>
                            <div
                                id="usersLoadingIndicator"
                                class="text-center py-3"
                            >
                                <div
                                    class="spinner-border text-primary"
                                    role="status"
                                >
                                    <span class="visually-hidden"
                                        >Loading...</span
                                    >
                                </div>
                            </div>
                            <div
                                id="usersEmptyState"
                                class="text-center py-5 d-none"
                            >
                                <i
                                    class="fas fa-users fa-3x text-muted mb-3"
                                ></i>
                                <h4 class="text-muted">No Users Found</h4>
                                <p class="text-muted">
                                    Get started by adding your first user.
                                </p>
                                <button
                                    type="button"
                                    class="btn btn-primary"
                                    data-bs-toggle="modal"
                                    data-bs-target="#addUserModal"
                                >
                                    <i class="fas fa-plus me-1"></i>
                                    Add User
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Add User Modal -->
        <div class="modal fade" id="addUserModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-user-plus me-2"></i>Add New User
                        </h5>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-light">
                            <i class="fas fa-info-circle me-2"></i>
                            Create a new user account. All fields marked with *
                            are required.
                        </div>

                        <form id="addUserForm">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label for="firstName" class="form-label"
                                        >First Name *</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-user"></i>
                                        </span>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="firstName"
                                            placeholder="Enter first name"
                                            required
                                        />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="lastName" class="form-label"
                                        >Last Name *</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-user"></i>
                                        </span>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="lastName"
                                            placeholder="Enter last name"
                                            required
                                        />
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="email" class="form-label"
                                    >Email Address *</label
                                >
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-envelope"></i>
                                    </span>
                                    <input
                                        type="email"
                                        class="form-control"
                                        id="email"
                                        placeholder="user@example.com"
                                        required
                                    />
                                </div>
                            </div>

                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label for="userType" class="form-label"
                                        >User Type *</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-id-badge"></i>
                                        </span>
                                        <select
                                            class="form-select"
                                            id="userType"
                                            required
                                        >
                                            <option value="">
                                                Select Role
                                            </option>
                                            <option value="viewer">
                                                üì∫ Viewer
                                            </option>
                                            <option value="creator">
                                                üé¨ Creator
                                            </option>
                                            <option value="admin">
                                                ‚ö° Admin
                                            </option>
                                        </select>
                                    </div>
                                    <small
                                        >Choose the user's role and
                                        permissions</small
                                    >
                                </div>
                                <div class="col-md-6">
                                    <label for="status" class="form-label"
                                        >Account Status</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-toggle-on"></i>
                                        </span>
                                        <select class="form-select" id="status">
                                            <option value="active">
                                                ‚úÖ Active
                                            </option>
                                            <option value="inactive">
                                                ‚è∏Ô∏è Inactive
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Cancel
                        </button>
                        <button
                            type="button"
                            class="btn btn-primary"
                            id="saveUser"
                        >
                            <i class="fas fa-user-plus me-1"></i>Create User
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit User Modal -->
        <div class="modal fade" id="editUserModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-user-edit me-2"></i>Edit User
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-warning">
                            <i class="fas fa-info-circle me-2"></i>
                            Update user information and permissions.
                        </div>

                        <form id="editUserForm">
                            <input type="hidden" id="editUserId" />
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label
                                        for="editFirstName"
                                        class="form-label"
                                        >First Name *</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-user"></i>
                                        </span>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="editFirstName"
                                            placeholder="Enter first name"
                                            required
                                        />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="editLastName" class="form-label"
                                        >Last Name *</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-user"></i>
                                        </span>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="editLastName"
                                            placeholder="Enter last name"
                                            required
                                        />
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="editEmail" class="form-label"
                                    >Email Address *</label
                                >
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-envelope"></i>
                                    </span>
                                    <input
                                        type="email"
                                        class="form-control"
                                        id="editEmail"
                                        placeholder="user@example.com"
                                        required
                                    />
                                </div>
                            </div>

                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label for="editUserType" class="form-label"
                                        >User Type *</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-id-badge"></i>
                                        </span>
                                        <select
                                            class="form-select"
                                            id="editUserType"
                                            required
                                        >
                                            <option value="viewer">
                                                üì∫ Viewer
                                            </option>
                                            <option value="creator">
                                                üé¨ Creator
                                            </option>
                                            <option value="admin">
                                                ‚ö° Admin
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="editStatus" class="form-label"
                                        >Account Status</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-toggle-on"></i>
                                        </span>
                                        <select
                                            class="form-select"
                                            id="editStatus"
                                        >
                                            <option value="active">
                                                ‚úÖ Active
                                            </option>
                                            <option value="inactive">
                                                ‚è∏Ô∏è Inactive
                                            </option>
                                            <option value="suspended">
                                                ‚è∏Ô∏è Suspended
                                            </option>
                                            <option value="revoked">
                                                ‚ùå Revoked
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Cancel
                        </button>
                        <button
                            type="button"
                            class="btn btn-warning"
                            id="updateUser"
                        >
                            <i class="fas fa-save me-1"></i>Update User
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Details Modal -->
        <div class="modal fade" id="userDetailsModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-user-circle me-2"></i>User Details
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">User ID:</label>
                                <p class="mb-0" id="detailUserId">Loading...</p>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Name:</label>
                                <p class="mb-0" id="detailUserName">Loading...</p>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Email:</label>
                                <p class="mb-0" id="detailUserEmail">Loading...</p>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email Verified:</label>
                                <p class="mb-0" id="detailEmailVerified">Loading...</p>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Role:</label>
                                <span class="badge bg-primary" id="detailUserRole">Loading...</span>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status:</label>
                                <span class="badge bg-success" id="detailUserStatus">Loading...</span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Join Date:</label>
                                <p class="mb-0" id="detailJoinDate">Loading...</p>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Last Seen:</label>
                                <p class="mb-0" id="detailLastSeen">Loading...</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Close
                        </button>
                        <button type="button" class="btn btn-primary" onclick="editUserFromDetails()">
                            <i class="fas fa-edit me-1"></i>Edit User
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirm Delete Modal -->
        <div class="modal fade" id="confirmDeleteModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg">
                    <div class="modal-header bg-danger text-white border-0">
                        <h5 class="modal-title fw-bold">
                            <i class="fas fa-exclamation-triangle me-2"></i
                            >Confirm Deletion
                        </h5>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body p-4">
                        <div class="text-center mb-4">
                            <div
                                class="bg-danger-subtle rounded-circle d-inline-flex align-items-center justify-content-center"
                                style="width: 80px; height: 80px"
                            >
                                <i
                                    class="fas fa-trash-alt fa-2x text-danger"
                                ></i>
                            </div>
                        </div>

                        <div class="text-center mb-4">
                            <h6 class="fw-bold text-dark mb-2">
                                Are you absolutely sure?
                            </h6>
                            <p class="text-muted mb-0">
                                This action cannot be undone. This will
                                permanently delete the user account and all
                                associated data.
                            </p>
                        </div>

                        <div
                            class="alert alert-danger border-0 bg-danger-subtle"
                        >
                            <div class="d-flex align-items-start">
                                <i
                                    class="fas fa-exclamation-triangle text-danger me-3 mt-1"
                                ></i>
                                <div>
                                    <h6 class="alert-heading mb-2">
                                        Data that will be permanently deleted:
                                    </h6>
                                    <ul class="mb-0 small">
                                        <li>
                                            User profile and account information
                                        </li>
                                        <li>All uploaded videos and content</li>
                                        <li>
                                            Purchase history and transaction
                                            records
                                        </li>
                                        <li>User preferences and settings</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-light-subtle p-3 rounded">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Consider suspending the account instead if you
                                might need to restore access later.
                            </small>
                        </div>
                    </div>
                    <div class="modal-footer bg-light border-0 px-4 py-3">
                        <button
                            type="button"
                            class="btn btn-outline-secondary"
                            data-bs-dismiss="modal"
                        >
                            <i class="fas fa-times me-2"></i>Cancel
                        </button>
                        <button
                            type="button"
                            class="btn btn-danger px-4"
                            id="confirmDeleteBtn"
                        >
                            <i class="fas fa-trash-alt me-2"></i>Delete
                            Permanently
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- jQuery and DataTable Libraries -->
        <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.4.1/js/responsive.bootstrap5.min.js"></script>
        <!-- Core Config (load first) -->
    
        <script src="../assets/js/config.js"></script>
        <script src="../assets/js/global-state.js"></script>
        <script src="../assets/js/api.js"></script>
        <script src="../assets/js/auth-manager.js"></script>
        <script src="../assets/js/common.js"></script>
        <script src="../assets/js/admin.js"></script>


        <script>
            // Initialize admin manager (SINGLE INSTANCE ONLY)
            let adminManager;

            document.addEventListener("DOMContentLoaded", function () {
                // Prevent multiple AdminManager instances
                if (!window.adminManager) {
                    console.log(
                        "Creating AdminManager instance from users.html",
                    );
                    window.adminManager = new AdminManager();
                    adminManager = window.adminManager;
                } else {
                    console.log("Using existing AdminManager instance");
                    adminManager = window.adminManager;
                }

                // Add user form handler
                const saveUserBtn = document.getElementById("saveUser");
                if (saveUserBtn) {
                    saveUserBtn.addEventListener("click", async function () {
                        const firstName = document
                            .getElementById("firstName")
                            .value.trim();
                        const lastName = document
                            .getElementById("lastName")
                            .value.trim();
                        const email = document
                            .getElementById("email")
                            .value.trim();
                        const userType =
                            document.getElementById("userType").value;
                        const status = document.getElementById("status").value;

                        if (!firstName || !email || !userType) {
                            alert("Please fill in all required fields");
                            return;
                        }

                        const userData = {
                            name: `${firstName} ${lastName}`.trim(),
                            email: email,
                            role: userType,
                            status: status,
                        };

                        const success = await adminManager.createUser(userData);
                        if (success) {
                            // Close modal and reset form
                            const modal = bootstrap.Modal.getInstance(
                                document.getElementById("addUserModal"),
                            );
                            modal.hide();
                            document.getElementById("addUserForm").reset();
                        }
                    });
                }

                // Edit user form handler
                const updateUserBtn = document.getElementById("updateUser");
                if (updateUserBtn) {
                    updateUserBtn.addEventListener("click", async function () {
                        const userId =
                            document.getElementById("editUserId").value;
                        const firstName = document
                            .getElementById("editFirstName")
                            .value.trim();
                        const lastName = document
                            .getElementById("editLastName")
                            .value.trim();
                        const email = document
                            .getElementById("editEmail")
                            .value.trim();
                        const userType =
                            document.getElementById("editUserType").value;
                        const status =
                            document.getElementById("editStatus").value;

                        if (!firstName || !email || !userType) {
                            alert("Please fill in all required fields");
                            return;
                        }

                        const userData = {
                            id: userId,
                            name: `${firstName} ${lastName}`.trim(),
                            email: email,
                            role: userType,
                            status: status,
                        };

                        const success = await adminManager.updateUser(userData);
                        if (success) {
                            // Close modal
                            const modal = bootstrap.Modal.getInstance(
                                document.getElementById("editUserModal"),
                            );
                            modal.hide();
                        }
                    });
                }
            });

            // Global functions for convenience
            function viewUserDetails(userId) {
                if (adminManager) adminManager.showUserDetails(userId);
            }

            function editUserInline(userId) {
                if (adminManager) adminManager.editUser(userId);
            }

            function revokeUser(userId) {
                showUserActionModal('revoke', userId);
            }

            function deleteUser(userId) {
                showUserActionModal('delete', userId);
            }
            
            function showUserActionModal(action, userId) {
                const user = adminManager?.users?.find(u => u.id == userId);
                if (!user) return;
                
                const actionTexts = {
                    revoke: { 
                        title: 'Revoke User Access', 
                        message: 'revoke access for', 
                        class: 'warning',
                        description: 'This will disable the user account but keep all data intact.'
                    },
                    delete: { 
                        title: 'Delete User Account', 
                        message: 'permanently delete', 
                        class: 'danger',
                        description: 'This will permanently delete the user account and all associated data. This action cannot be undone.'
                    }
                };
                
                const actionData = actionTexts[action];
                if (!actionData) return;
                
                // Create confirmation modal
                let modal = document.getElementById('userActionConfirmModal');
                if (!modal) {
                    modal = document.createElement('div');
                    modal.className = 'modal fade';
                    modal.id = 'userActionConfirmModal';
                    modal.setAttribute('tabindex', '-1');
                    modal.innerHTML = `
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="userActionModalTitle">Confirm Action</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <p id="userActionModalMessage">Are you sure you want to perform this action?</p>
                                    <div class="alert alert-warning" id="userActionDescription">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <span id="userActionDescriptionText"></span>
                                    </div>
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title" id="userActionModalUserName">User Name</h6>
                                            <p class="card-text text-muted" id="userActionModalUserEmail">Email</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn" id="confirmUserActionBtn">Confirm</button>
                                </div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                }
                
                // Update modal content
                document.getElementById('userActionModalTitle').textContent = actionData.title;
                document.getElementById('userActionModalMessage').textContent = `Are you sure you want to ${actionData.message} this user?`;
                document.getElementById('userActionDescriptionText').textContent = actionData.description;
                document.getElementById('userActionModalUserName').textContent = user.name || 'Unknown User';
                document.getElementById('userActionModalUserEmail').textContent = user.email || 'No email';
                
                const confirmBtn = document.getElementById('confirmUserActionBtn');
                const descriptionAlert = document.getElementById('userActionDescription');
                
                confirmBtn.className = `btn btn-${actionData.class}`;
                confirmBtn.textContent = actionData.title.split(' ')[0];
                descriptionAlert.className = `alert alert-${actionData.class}`;
                
                // Set up confirm button action
                confirmBtn.onclick = function() {
                    const bootstrapModal = bootstrap.Modal.getInstance(modal);
                    bootstrapModal.hide();
                    performUserAction(action, userId);
                };
                
                const bootstrapModal = new bootstrap.Modal(modal);
                bootstrapModal.show();
            }
            
            function performUserAction(action, userId) {
                if (action === 'revoke') {
                    if (adminManager) adminManager.revokeUser(userId);
                } else if (action === 'delete') {
                    if (adminManager) adminManager.deleteUser(userId);
                }
            }

            function exportUsers() {
                if (!adminManager || !adminManager.users) return;

                // Simple CSV export
                const users = adminManager.users;
                const csvContent =
                    "data:text/csv;charset=utf-8,ID,Name,Email,Role,Status,Join Date\n" +
                    users
                        .map(
                            (user) =>
                                `${user.id},"${user.name}","${user.email}","${user.role}","${user.status}","${user.joinDate}"`,
                        )
                        .join("\n");

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "users.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        </script>
    </body>
</html>