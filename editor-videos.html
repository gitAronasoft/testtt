
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Videos - YouTube Video Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-lg">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="dashboard.html">
                <i class="fas fa-video text-warning"></i> YouTube Manager
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="editor-upload.html">
                            <i class="fas fa-upload"></i> Upload Video
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="editor-videos.html">
                            <i class="fas fa-edit"></i> My Videos
                        </a>
                    </li>
                </ul>
                
                <div class="navbar-nav">
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                            <div class="user-avatar me-2" id="navUserAvatar">E</div>
                            <span id="navUserName">Editor</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
                            <li><a class="dropdown-item" href="settings.html"><i class="fas fa-cog"></i> Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2><i class="fas fa-video text-primary"></i> My Videos</h2>
                <p class="text-muted">Manage and edit your uploaded videos</p>
            </div>
            <div>
                <a href="editor-upload.html" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Upload New Video
                </a>
                <button class="btn btn-outline-secondary" onclick="refreshVideos()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="display-6 text-primary mb-2">
                            <i class="fas fa-video"></i>
                        </div>
                        <h4 class="text-primary" id="totalVideosCount">0</h4>
                        <p class="text-muted mb-0">Total Videos</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="display-6 text-success mb-2">
                            <i class="fas fa-eye"></i>
                        </div>
                        <h4 class="text-success" id="totalViewsCount">0</h4>
                        <p class="text-muted mb-0">Total Views</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="display-6 text-warning mb-2">
                            <i class="fas fa-thumbs-up"></i>
                        </div>
                        <h4 class="text-warning" id="totalLikesCount">0</h4>
                        <p class="text-muted mb-0">Total Likes</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="display-6 text-info mb-2">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h4 class="text-info" id="avgEngagement">0%</h4>
                        <p class="text-muted mb-0">Avg Engagement</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="searchVideos" placeholder="🔍 Search videos...">
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="published">Published</option>
                            <option value="private">Private</option>
                            <option value="unlisted">Unlisted</option>
                            <option value="draft">Draft</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="sortFilter">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="most_viewed">Most Viewed</option>
                            <option value="title">Title A-Z</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-outline-secondary w-100" onclick="clearFilters()">Clear Filters</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Videos Grid -->
        <div class="row" id="videosContainer">
            <!-- Videos will be loaded here -->
        </div>

        <!-- No Videos Message -->
        <div id="noVideos" class="text-center py-5" style="display: none;">
            <div class="text-muted">
                <i class="fas fa-video fa-4x mb-3"></i>
                <h4>No videos found</h4>
                <p>You haven't uploaded any videos yet. <a href="editor-upload.html">Upload your first video</a> to get started!</p>
            </div>
        </div>
    </div>

    <!-- Edit Video Modal -->
    <div class="modal fade" id="editVideoModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Video</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editVideoForm">
                        <input type="hidden" id="editVideoId">
                        <div class="mb-3">
                            <label for="editTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="editTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="editDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editDescription" rows="4"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editTags" class="form-label">Tags</label>
                            <input type="text" class="form-control" id="editTags" placeholder="tag1, tag2, tag3">
                        </div>
                        <div class="mb-3">
                            <label for="editPrivacy" class="form-label">Privacy</label>
                            <select class="form-select" id="editPrivacy">
                                <option value="public">Public</option>
                                <option value="unlisted">Unlisted</option>
                                <option value="private">Private</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveVideoEdit()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/common.js"></script>
    <script src="assets/js/visual-enhancements.js"></script>
    <script>
        let myVideos = [];
        let filteredVideos = [];

        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is editor or admin
            const userRole = localStorage.getItem('userRole');
            if (userRole === 'viewer') {
                alert('Access denied. This page is for editors only.');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
                return;
            }

            loadMyVideos();
            setupEventListeners();
            updateNavUser();
        });

        function updateNavUser() {
            const userName = localStorage.getItem('userName') || 'Editor';
            const userRole = localStorage.getItem('userRole') || 'editor';
            
            document.getElementById('navUserName').textContent = userName;
            document.getElementById('navUserAvatar').textContent = userName.charAt(0).toUpperCase();
        }

        function setupEventListeners() {
            document.getElementById('searchVideos').addEventListener('input', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('sortFilter').addEventListener('change', applyFilters);
        }

        function loadMyVideos() {
            // Get uploaded videos from localStorage
            const uploadedVideos = JSON.parse(localStorage.getItem('uploadedVideos') || '[]');
            const currentUser = localStorage.getItem('userName') || 'Editor';
            
            // Filter videos uploaded by current user
            myVideos = uploadedVideos.filter(video => video.uploadedBy === currentUser);
            
            // Add some demo videos if none exist
            if (myVideos.length === 0) {
                myVideos = getDemoVideos();
                // Save demo videos
                const allVideos = JSON.parse(localStorage.getItem('uploadedVideos') || '[]');
                allVideos.push(...myVideos);
                localStorage.setItem('uploadedVideos', JSON.stringify(allVideos));
            }
            
            filteredVideos = [...myVideos];
            updateStatistics();
            applyFilters();
        }

        function getDemoVideos() {
            const currentUser = localStorage.getItem('userName') || 'Editor';
            return [
                {
                    id: 'DEMO_1',
                    title: 'My First Tutorial Video',
                    description: 'This is my first tutorial video about web development',
                    uploadedBy: currentUser,
                    uploadedAt: new Date().toISOString(),
                    status: 'published',
                    privacy: 'public',
                    views: 1250,
                    likes: 89,
                    duration: '12:30',
                    thumbnail: '🎬',
                    tags: ['tutorial', 'web development', 'beginner']
                },
                {
                    id: 'DEMO_2',
                    title: 'JavaScript Tips and Tricks',
                    description: 'Advanced JavaScript techniques for better coding',
                    uploadedBy: currentUser,
                    uploadedAt: new Date(Date.now() - 86400000).toISOString(),
                    status: 'published',
                    privacy: 'public',
                    views: 892,
                    likes: 67,
                    duration: '15:45',
                    thumbnail: '💻',
                    tags: ['javascript', 'programming', 'tips']
                }
            ];
        }

        function updateStatistics() {
            const totalVideos = myVideos.length;
            const totalViews = myVideos.reduce((sum, video) => sum + (video.views || 0), 0);
            const totalLikes = myVideos.reduce((sum, video) => sum + (video.likes || 0), 0);
            const avgEngagement = totalViews > 0 ? ((totalLikes / totalViews) * 100).toFixed(1) : 0;

            document.getElementById('totalVideosCount').textContent = totalVideos;
            document.getElementById('totalViewsCount').textContent = formatNumber(totalViews);
            document.getElementById('totalLikesCount').textContent = formatNumber(totalLikes);
            document.getElementById('avgEngagement').textContent = avgEngagement + '%';
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchVideos').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const sortFilter = document.getElementById('sortFilter').value;

            filteredVideos = myVideos.filter(video => {
                const matchesSearch = !searchTerm || 
                    video.title.toLowerCase().includes(searchTerm) ||
                    video.description.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || video.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            // Sort videos
            sortVideos(sortFilter);
            renderVideos();
        }

        function sortVideos(sortBy) {
            switch(sortBy) {
                case 'newest':
                    filteredVideos.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt));
                    break;
                case 'oldest':
                    filteredVideos.sort((a, b) => new Date(a.uploadedAt) - new Date(b.uploadedAt));
                    break;
                case 'most_viewed':
                    filteredVideos.sort((a, b) => (b.views || 0) - (a.views || 0));
                    break;
                case 'title':
                    filteredVideos.sort((a, b) => a.title.localeCompare(b.title));
                    break;
            }
        }

        function renderVideos() {
            const container = document.getElementById('videosContainer');
            const noVideos = document.getElementById('noVideos');
            
            if (filteredVideos.length === 0) {
                container.innerHTML = '';
                noVideos.style.display = 'block';
                return;
            }

            noVideos.style.display = 'none';
            
            container.innerHTML = filteredVideos.map(video => `
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="position-relative">
                            <div class="video-thumbnail bg-light d-flex align-items-center justify-content-center" style="height: 200px; font-size: 3rem;">
                                ${video.thumbnail || '🎥'}
                            </div>
                            <span class="position-absolute top-0 end-0 m-2 badge ${getStatusBadgeClass(video.status)}">${video.status}</span>
                            <span class="position-absolute bottom-0 end-0 m-2 badge bg-dark">${video.duration}</span>
                        </div>
                        <div class="card-body">
                            <h6 class="card-title">${video.title}</h6>
                            <p class="card-text text-muted small">${truncateText(video.description, 80)}</p>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <small class="text-muted">
                                    <i class="fas fa-eye"></i> ${formatNumber(video.views || 0)} views
                                </small>
                                <small class="text-muted">
                                    <i class="fas fa-thumbs-up"></i> ${formatNumber(video.likes || 0)}
                                </small>
                            </div>
                            <small class="text-muted d-block mb-3">${formatDate(video.uploadedAt)}</small>
                            <div class="btn-group w-100" role="group">
                                <button class="btn btn-outline-primary btn-sm" onclick="editVideo('${video.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewAnalytics('${video.id}')">
                                    <i class="fas fa-chart-line"></i> Stats
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteVideo('${video.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusBadgeClass(status) {
            const classes = {
                'published': 'bg-success',
                'private': 'bg-warning',
                'unlisted': 'bg-info',
                'draft': 'bg-secondary'
            };
            return classes[status] || 'bg-secondary';
        }

        function truncateText(text, maxLength) {
            if (!text) return '';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }

        function editVideo(videoId) {
            const video = myVideos.find(v => v.id === videoId);
            if (!video) return;

            document.getElementById('editVideoId').value = video.id;
            document.getElementById('editTitle').value = video.title;
            document.getElementById('editDescription').value = video.description || '';
            document.getElementById('editTags').value = (video.tags || []).join(', ');
            document.getElementById('editPrivacy').value = video.privacy || 'public';

            new bootstrap.Modal(document.getElementById('editVideoModal')).show();
        }

        function saveVideoEdit() {
            const videoId = document.getElementById('editVideoId').value;
            const title = document.getElementById('editTitle').value;
            const description = document.getElementById('editDescription').value;
            const tags = document.getElementById('editTags').value.split(',').map(t => t.trim());
            const privacy = document.getElementById('editPrivacy').value;

            // Update video in arrays
            const video = myVideos.find(v => v.id === videoId);
            if (video) {
                video.title = title;
                video.description = description;
                video.tags = tags;
                video.privacy = privacy;
                video.status = privacy === 'private' ? 'private' : 'published';
            }

            // Update localStorage
            const allVideos = JSON.parse(localStorage.getItem('uploadedVideos') || '[]');
            const videoIndex = allVideos.findIndex(v => v.id === videoId);
            if (videoIndex !== -1) {
                allVideos[videoIndex] = video;
                localStorage.setItem('uploadedVideos', JSON.stringify(allVideos));
            }

            bootstrap.Modal.getInstance(document.getElementById('editVideoModal')).hide();
            applyFilters();
            showAlert('Video updated successfully!', 'success');
        }

        function viewAnalytics(videoId) {
            const video = myVideos.find(v => v.id === videoId);
            if (video) {
                alert(`Video Analytics for "${video.title}":\n\nViews: ${formatNumber(video.views || 0)}\nLikes: ${formatNumber(video.likes || 0)}\nUpload Date: ${formatDate(video.uploadedAt)}\nStatus: ${video.status}`);
            }
        }

        function deleteVideo(videoId) {
            const video = myVideos.find(v => v.id === videoId);
            if (!video) return;

            if (confirm(`Are you sure you want to delete "${video.title}"? This action cannot be undone.`)) {
                // Remove from arrays
                myVideos = myVideos.filter(v => v.id !== videoId);
                filteredVideos = filteredVideos.filter(v => v.id !== videoId);

                // Update localStorage
                const allVideos = JSON.parse(localStorage.getItem('uploadedVideos') || '[]');
                const updatedVideos = allVideos.filter(v => v.id !== videoId);
                localStorage.setItem('uploadedVideos', JSON.stringify(updatedVideos));

                updateStatistics();
                applyFilters();
                showAlert('Video deleted successfully!', 'success');
            }
        }

        function clearFilters() {
            document.getElementById('searchVideos').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('sortFilter').value = 'newest';
            applyFilters();
        }

        function refreshVideos() {
            loadMyVideos();
            showAlert('Videos refreshed!', 'success');
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }

        function showAlert(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-danger' : 'alert-info';
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }
    </script>
</body>
</html>
