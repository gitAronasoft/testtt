
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Video - Video Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(214.3 31.8% 91.4%)",
                        input: "hsl(214.3 31.8% 91.4%)",
                        ring: "hsl(222.2 84% 4.9%)",
                        background: "hsl(0 0% 100%)",
                        foreground: "hsl(222.2 84% 4.9%)",
                        primary: {
                            DEFAULT: "hsl(222.2 47.4% 11.2%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                        secondary: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        muted: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(215.4 16.3% 46.9%)",
                        },
                        accent: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        destructive: {
                            DEFAULT: "hsl(0 84.2% 60.2%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                    },
                    keyframes: {
                        "fade-in": {
                            "0%": { opacity: "0", transform: "translateY(10px)" },
                            "100%": { opacity: "1", transform: "translateY(0)" },
                        },
                        "slide-up": {
                            "0%": { opacity: "0", transform: "translateY(20px)" },
                            "100%": { opacity: "1", transform: "translateY(0)" },
                        },
                    },
                    animation: {
                        "fade-in": "fade-in 0.5s ease-out",
                        "slide-up": "slide-up 0.6s ease-out",
                    },
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-background font-sans antialiased">
    <!-- Navigation -->
    <nav class="sticky top-0 z-50 w-full border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex h-16 items-center justify-between">
                <a href="dashboard.html" class="flex items-center space-x-2 transition-colors hover:text-primary">
                    <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-primary-foreground">
                        <i class="fas fa-video text-sm"></i>
                    </div>
                    <span class="hidden font-bold sm:inline-block">Video Platform</span>
                </a>
                
                <a href="dashboard.html" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3">
                    <i class="fas fa-arrow-left mr-2 h-4 w-4"></i>
                    Back to Dashboard
                </a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <div class="mx-auto max-w-4xl space-y-8">
            <!-- Header -->
            <div class="text-center animate-fade-in">
                <h1 class="text-3xl font-bold tracking-tight text-foreground">Upload Video</h1>
                <p class="mt-2 text-muted-foreground">Share your content with the world</p>
            </div>

            <!-- YouTube Status Card -->
            <div class="animate-slide-up rounded-2xl border border-border bg-card p-6 shadow-sm" style="animation-delay: 0.1s">
                <div id="youtube-status">
                    <div id="not-connected" class="flex items-start space-x-4 rounded-lg border border-yellow-200 bg-yellow-50 p-4">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-sm font-medium text-yellow-800">YouTube not connected</h3>
                            <p class="mt-1 text-sm text-yellow-700">Connect your YouTube account to upload videos directly to YouTube.</p>
                            <div class="mt-3">
                                <button id="connect-youtube" class="inline-flex items-center rounded-md bg-destructive px-3 py-2 text-sm font-semibold text-destructive-foreground shadow-sm hover:bg-destructive/90 transition-colors">
                                    <i class="fab fa-youtube mr-2"></i>
                                    Connect YouTube
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="connected" class="hidden flex items-start space-x-4 rounded-lg border border-green-200 bg-green-50 p-4">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-sm font-medium text-green-800">YouTube Connected</h3>
                            <p class="mt-1 text-sm text-green-700">You can now upload videos to YouTube and set pricing.</p>
                            <div class="mt-3">
                                <button id="disconnect-youtube" class="inline-flex items-center rounded-md border border-red-300 bg-white px-3 py-2 text-sm font-semibold text-red-700 shadow-sm hover:bg-red-50 transition-colors">
                                    Disconnect
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Form -->
            <div class="animate-slide-up rounded-2xl border border-border bg-card p-8 shadow-sm" style="animation-delay: 0.2s">
                <form id="upload-form" class="space-y-6">
                    <!-- File Upload -->
                    <div class="space-y-2">
                        <label for="video-file" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                            Video File
                        </label>
                        <div class="relative">
                            <input
                                id="video-file"
                                type="file"
                                accept="video/*"
                                required
                                class="flex h-12 w-full rounded-lg border border-dashed border-input bg-background px-4 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200"
                            />
                        </div>
                    </div>

                    <!-- Title -->
                    <div class="space-y-2">
                        <label for="title" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                            Title
                        </label>
                        <input
                            id="title"
                            type="text"
                            required
                            class="flex h-12 w-full rounded-lg border border-input bg-background px-4 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200"
                            placeholder="Enter video title"
                        />
                    </div>

                    <!-- Description -->
                    <div class="space-y-2">
                        <label for="description" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                            Description
                        </label>
                        <textarea
                            id="description"
                            rows="4"
                            class="flex min-h-[120px] w-full rounded-lg border border-input bg-background px-4 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none transition-all duration-200"
                            placeholder="Describe your video..."
                        ></textarea>
                    </div>

                    <!-- Price and Category Row -->
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        <div class="space-y-2">
                            <label for="price" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                                Price ($)
                            </label>
                            <input
                                id="price"
                                type="number"
                                min="0"
                                step="0.01"
                                value="0"
                                class="flex h-12 w-full rounded-lg border border-input bg-background px-4 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200"
                                placeholder="0.00"
                            />
                        </div>

                        <div class="space-y-2">
                            <label for="category" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                                Category
                            </label>
                            <select
                                id="category"
                                class="flex h-12 w-full rounded-lg border border-input bg-background px-4 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200"
                            >
                                <option value="education">Education</option>
                                <option value="entertainment">Entertainment</option>
                                <option value="music">Music</option>
                                <option value="gaming">Gaming</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <!-- YouTube Options -->
                    <div id="youtube-options" class="hidden space-y-4 rounded-lg border border-border bg-muted/50 p-4">
                        <div class="flex items-center space-x-2">
                            <input
                                id="upload-to-youtube"
                                type="checkbox"
                                checked
                                class="h-4 w-4 rounded border-border text-primary focus:ring-2 focus:ring-ring focus:ring-offset-2"
                            />
                            <label for="upload-to-youtube" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                                Upload to YouTube
                            </label>
                        </div>

                        <div class="space-y-2">
                            <label for="privacy-status" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                                Privacy Status
                            </label>
                            <select
                                id="privacy-status"
                                class="flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                            >
                                <option value="private">Private</option>
                                <option value="unlisted">Unlisted</option>
                                <option value="public">Public</option>
                            </select>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button
                        type="submit"
                        id="upload-btn"
                        class="inline-flex w-full items-center justify-center rounded-lg bg-primary px-4 py-3 text-sm font-medium text-primary-foreground ring-offset-background transition-all duration-200 hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"
                    >
                        <i class="fas fa-upload mr-2 h-4 w-4"></i>
                        <span id="upload-text">Upload Video</span>
                    </button>
                </form>

                <!-- Progress Bar -->
                <div id="upload-progress" class="mt-6 hidden space-y-2">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-muted-foreground">Uploading to YouTube...</span>
                        <span class="font-medium">0%</span>
                    </div>
                    <div class="h-2 w-full overflow-hidden rounded-full bg-secondary">
                        <div class="h-full bg-primary transition-all duration-300 ease-out" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 max-w-sm"></div>

    <script src="assets/js/youtube-api-client.js"></script>
    <script>
        let isUploading = false;

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            toast.className = `${bgColor} text-white p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 mb-2`;
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-white/80 hover:text-white">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Override the original showNotification function if it exists
        window.showNotification = showToast;

        document.addEventListener('DOMContentLoaded', async function() {
            await checkYouTubeStatus();
            
            document.getElementById('connect-youtube').addEventListener('click', connectYouTube);
            document.getElementById('disconnect-youtube').addEventListener('click', disconnectYouTube);
            document.getElementById('upload-form').addEventListener('submit', handleUpload);
        });

        async function checkYouTubeStatus() {
            try {
                if (window.youtubeAPI) {
                    await window.youtubeAPI.initialize();
                    
                    if (window.youtubeAPI.isSignedIn()) {
                        document.getElementById('not-connected').classList.add('hidden');
                        document.getElementById('connected').classList.remove('hidden');
                        document.getElementById('youtube-options').classList.remove('hidden');
                    } else {
                        document.getElementById('not-connected').classList.remove('hidden');
                        document.getElementById('connected').classList.add('hidden');
                        document.getElementById('youtube-options').classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('YouTube status check failed:', error);
            }
        }

        async function connectYouTube() {
            try {
                if (window.youtubeAPI) {
                    const success = await window.youtubeAPI.signIn();
                    if (success) {
                        await checkYouTubeStatus();
                        showToast('Successfully connected to YouTube!', 'success');
                    } else {
                        showToast('Failed to connect to YouTube', 'error');
                    }
                }
            } catch (error) {
                console.error('YouTube connection failed:', error);
                showToast('YouTube connection failed: ' + error.message, 'error');
            }
        }

        async function disconnectYouTube() {
            try {
                if (window.youtubeAPI) {
                    await window.youtubeAPI.signOut();
                    await checkYouTubeStatus();
                    showToast('Disconnected from YouTube', 'info');
                }
            } catch (error) {
                console.error('YouTube disconnect failed:', error);
                showToast('Failed to disconnect from YouTube', 'error');
            }
        }

        async function handleUpload(event) {
            event.preventDefault();
            
            if (isUploading) return;
            
            const videoFile = document.getElementById('video-file').files[0];
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const price = document.getElementById('price').value;
            const category = document.getElementById('category').value;
            const uploadToYouTube = document.getElementById('upload-to-youtube').checked;
            const privacyStatus = document.getElementById('privacy-status').value;
            
            if (!videoFile) {
                showToast('Please select a video file', 'error');
                return;
            }
            
            if (!title.trim()) {
                showToast('Please enter a title', 'error');
                return;
            }
            
            isUploading = true;
            setUploadingState(true);
            
            try {
                let youtubeId = null;
                
                if (uploadToYouTube && window.youtubeAPI && window.youtubeAPI.isSignedIn()) {
                    showToast('Uploading to YouTube...', 'info');
                    document.getElementById('upload-progress').classList.remove('hidden');
                    
                    const youtubeResult = await window.youtubeAPI.uploadVideo(videoFile, {
                        title: title,
                        description: description,
                        privacyStatus: privacyStatus,
                        categoryId: getCategoryId(category)
                    });
                    
                    if (youtubeResult.success) {
                        youtubeId = youtubeResult.youtube_id;
                        showToast('Successfully uploaded to YouTube!', 'success');
                    }
                }
                
                // Save to local database
                const response = await fetch('api/videos.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        description: description,
                        price: price,
                        category: category,
                        youtube_id: youtubeId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('Video uploaded successfully!', 'success');
                    document.getElementById('upload-form').reset();
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1500);
                } else {
                    showToast('Failed to save video: ' + result.message, 'error');
                }
                
            } catch (error) {
                console.error('Upload failed:', error);
                showToast('Upload failed: ' + error.message, 'error');
            } finally {
                isUploading = false;
                setUploadingState(false);
                document.getElementById('upload-progress').classList.add('hidden');
            }
        }

        function setUploadingState(uploading) {
            const uploadBtn = document.getElementById('upload-btn');
            const uploadText = document.getElementById('upload-text');
            
            if (uploading) {
                uploadBtn.disabled = true;
                uploadText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Uploading...';
            } else {
                uploadBtn.disabled = false;
                uploadText.innerHTML = '<i class="fas fa-upload mr-2"></i>Upload Video';
            }
        }

        function getCategoryId(category) {
            const categoryMap = {
                'education': '27',
                'entertainment': '24',
                'music': '10',
                'gaming': '20',
                'other': '22'
            };
            return categoryMap[category] || '22';
        }
    </script>
</body>
</html>
